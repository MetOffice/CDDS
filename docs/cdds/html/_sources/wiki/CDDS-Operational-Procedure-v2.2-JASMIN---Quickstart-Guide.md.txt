# CDDS Operational Procedure (v2.2.3+) on JASMIN _(for the impatient)_

The following document describes the simplified CDDS processing workflow on JASMIN _if your data is in MASS_.

For more information please consult [[CDDS Operational Procedure v2.2 JASMIN|CDDS Operational Procedure v2.2 JASMIN]].

1. Update the [Rose Suite Metadata](https://code.metoffice.gov.uk/trac/ukcmip6/wiki/CMIP6/RoseSuiteMetadata).
2. SSH into `mass-cli1` server.
3. Set up the environment with `source /gws/smf/j04/cmip6_prep/cdds-env-python3/miniconda3/bin/activate cdds-2.2.3`
4. Set up your `$ROOT_PROC` and `$ROOT_DATA` directories for processing logs and configuration, and actual data.
5. Create the `request.json` file with
   * ```bash
     write_rose_suite_request_json <suite id> <branch> <revision> <package name> [<list of streams>]
     ```
     e.g.
   * ```bash
     write_rose_suite_request_json u-aw310 cdds 115492 round-20 ap4 ap5 ap6 onm inm
     ```
6. Create directories
   * ```bash
     create_cdds_directory_structure request.json -c $ROOT_PROC -t $ROOT_DATA
     ```
7. Create a list of variables for processing (in this example, named `variables_to_process.txt`), one variable per line
   * ```bash
     mip_table/variable[:stream[/substream]]
     ```
     e.g
   * ```bash
     Amon/tas
     Amon/pr:apm
     Omon/tos
     Omon/epcalc100:onm/ptrd-T
     ```
   * For experiment setup which mirrors CMIP6 experiments, you can skip the stream/substream names, and CDDS will use CMIP6 defaults.
8. Generate requested variables file
   * ```bash
     prepare_generate_variable_list request.json -p  -c $ROOT_PROC -t $ROOT_DATA -r variables_to_process.txt --no_inventory_check
     ```
9. (Recommended for first or large batches of processing) run standalone extract job
   * ```bash
     cdds_extract_spice request.json -c $ROOT_PROC -t $ROOT_DATA
     ```
   * If following the above step step run
     ```bash
     cdds_convert request.json -c $ROOT_PROC -t $ROOT_DATA --skip_transfer --skip_extract
     ```
   * If no data extraction has been done yet (i.e. step 9A has been skipped), run
     ```bash
     cdds_convert request.json -c $ROOT_PROC -t $ROOT_DATA --skip_transfer
     ```
   * If your data is not in MASS but on ARCHER, please check [[CDDS Operational Procedure v2.2 JASMIN|CDDS Operational Procedure v2.2 JASMIN]] for detailed instructions.
10. Use `cylc gscan -n cdds*` to monitor processing suites.